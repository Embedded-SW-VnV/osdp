OCAMLC=../revert_cclib.sh ocamlc
OCAMLOPT=../revert_cclib.sh ocamlopt
OCAMLBUILD=@OCAMLBUILD@ -classic-display -no-links \
-ocamlc "${OCAMLC}" -ocamlopt "${OCAMLOPT}"

prefix=@prefix@
exec_prefix=@exec_prefix@
bindir=@bindir@
datarootdir=@datarootdir@
sharedir=@datadir@

LOCAL_BINDIR=.
LOCAL_LIBDIR=lib

osdp:
	$(OCAMLBUILD) osdp.cmxa
	$(OCAMLBUILD) osdp.cma

test:
	$(OCAMLBUILD) test/test.native


test-sos:
	$(OCAMLBUILD) sos/test.native

clean:
	$(OCAMLBUILD) -clean
	rm -f *~ sdp/*~ 

dist-clean: clean
	rm -f Makefile myocamlbuild.ml global.ml Makefile config.log config.status configure

/usr/local/share/csdp/param.csdp:
	mkdir -p /usr/local/share/csdp/
	cp external/param.csdp /usr/local/share/csdp/

install-deps: /usr/local/share/csdp/param.csdp

install-findlib:
	ocamlfind install osdp META _build/libosdp.a _build/osdp.a _build/osdp.cmxa _build/osdp.cma _build/sdp/sdp.cmi _build/sdp/LMI.cmi _build/sdp/matrix.cmi _build/cholewski/posdef.cmi _build/sdp/csdp.cmi _build/sdp/csdp_stubs.o 

uninstall-findlib:
	ocamlfind remove osdp

hack:
	ocamlopt ./utils/sette.mli
	ocamlopt -I utils ./utils/mappe.mli
	ocamlopt -I utils ./utils/report.mli
	ocamlopt -I utils ./sdp/matrix.mli
	ocamlopt -I utils -I sdp ./sdp/csdp.mli
	ocamlopt -I utils -I sdp ./sdp/sdp.mli
	ocamlopt -I utils -I sdp ./sdp/LMI.mli
	/usr/bin/ocamlc.opt -ccopt -DNOSHORTS -ccopt -I/usr/local/include/csdp -c sdp/csdp_stubs.c
	ocamlmklib -o osdp -I utils -I sdp global.ml utils/sette.ml utils/mappe.ml utils/report.ml utils/utils.ml sdp/matrix.ml sdp/csdp.ml csdp_stubs.o sdp/sdp.ml sdp/LMI.ml
	ocamlfind install osdp META libosdp.a osdp.a osdp.cmxa osdp.cma sdp/sdp.cmi sdp/LMI.cmi sdp/matrix.cmi sdp/csdp.cmi csdp_stubs.o

.PHONY: osdp test clean install install-deps dist-clean
